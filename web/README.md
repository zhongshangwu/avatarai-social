# AvatarAI Social 前端页面

这是一个前后端分离的单页面应用，用于处理 AvatarAI Social 的用户认证和基本功能。

## 功能特性

### 🔐 OAuth 认证流程
- 支持 atproto 协议的 OAuth 登录
- 自动处理授权码交换访问令牌
- 支持令牌刷新和会话管理
- 安全的 Cookie 存储

### 🎯 用户界面
- 现代化的响应式设计
- 基于 Pico CSS 的美观界面
- 实时状态反馈和错误处理
- 流畅的用户体验

### 📱 核心功能
- **登录认证**: 支持 handle、DID 或 PDS URL 登录
- **用户信息**: 显示用户 DID 和 handle
- **令牌管理**: 自动刷新访问令牌
- **帖子创建**: 集成的内容发布功能
- **安全登出**: 清理所有会话数据

## 技术实现

### 前端技术栈
- **HTML5**: 语义化标记
- **CSS3**: Pico CSS 框架 + 自定义样式
- **JavaScript**: 原生 ES6+ 实现
- **Fetch API**: 现代化的 HTTP 请求

### 后端集成
- **RESTful API**: 与后端 Go 服务通信
- **JWT 认证**: 基于令牌的身份验证
- **OAuth 2.0**: 标准的授权流程
- **atproto 协议**: 去中心化社交协议支持

## API 端点

### 认证相关
- `POST /api/oauth/signin` - 发起 OAuth 登录
- `POST /api/oauth/token` - 交换访问令牌
- `POST /api/oauth/refresh` - 刷新访问令牌
- `GET /api/oauth/logout` - 用户登出

### 用户相关
- `GET /api/avatar/profile` - 获取用户信息
- `POST /api/aster/mint` - 创建 Aster（示例功能）

## 使用流程

### 1. 用户登录
1. 用户输入 handle、DID 或 PDS URL
2. 系统发起 OAuth 授权请求
3. 重定向到授权服务器进行身份验证
4. 授权成功后返回授权码
5. 前端自动交换访问令牌
6. 登录完成，显示用户信息

### 2. 会话管理
- 访问令牌存储在 HttpOnly Cookie 中
- 页面刷新时自动检查登录状态
- 令牌过期时自动刷新
- 支持手动刷新令牌

### 3. 功能使用
- 登录后可以创建帖子
- 查看用户个人信息
- 安全登出清理会话

## 安全特性

### 🔒 安全措施
- **HttpOnly Cookie**: 防止 XSS 攻击
- **CSRF 保护**: 状态参数验证
- **令牌过期**: 自动过期和刷新机制
- **安全重定向**: URL 验证和白名单

### 🛡️ 隐私保护
- 敏感信息不存储在 localStorage
- 自动清理过期会话
- 安全的登出流程

## 开发说明

### 本地开发
1. 启动后端服务
2. 访问 `http://localhost:8080/`
3. 开始使用应用

### 部署注意事项
- 确保 HTTPS 环境下的 Cookie 安全设置
- 配置正确的重定向 URI
- 设置适当的 CORS 策略

## 浏览器兼容性

- ✅ Chrome 60+
- ✅ Firefox 55+
- ✅ Safari 12+
- ✅ Edge 79+

## 故障排除

### 常见问题
1. **登录失败**: 检查 handle/DID 格式是否正确
2. **令牌过期**: 尝试刷新令牌或重新登录
3. **网络错误**: 检查后端服务是否正常运行

### 调试技巧
- 打开浏览器开发者工具查看网络请求
- 检查控制台错误信息
- 验证 Cookie 设置是否正确