<!doctype html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="referrer" content="origin-when-cross-origin">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.classless.purple.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/mcp.css">
    <title>AvatarAI Social - 智能社交平台</title>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1><i class="fas fa-robot"></i> AvatarAI Social</h1>
            <p id="user-greeting" class="user-greeting hidden">
                <i class="fas fa-user-circle"></i>
                你好 <span id="user-handle"></span>！欢迎来到智能社交平台
            </p>
            <div id="nav-menu" class="nav-menu hidden">
                <button id="refresh-token-btn">
                    <i class="fas fa-sync-alt"></i> 刷新令牌
                </button>
                <button id="logout-btn" class="btn-danger">
                    <i class="fas fa-sign-out-alt"></i> 登出
                </button>
            </div>
        </header>

        <!-- Message Container -->
        <div id="message-container"></div>

        <!-- Login Form -->
        <div id="login-form" class="card hidden">
            <h3><i class="fas fa-key"></i> 使用 atproto 登录</h3>
            <p>提供您的 handle 或 DID 以授权现有 PDS 帐户。<br>您也可以提供 PDS/入口 URL (例如, <code>https://pds.example.com</code>)。</p>

            <form id="oauth-login-form">
                <div class="form-group">
                    <label for="username">
                        <i class="fas fa-at"></i> Handle / DID / PDS URL
                    </label>
                    <input
                        name="username"
                        id="username"
                        placeholder="handle.example.com"
                        style="font-family: 'Monaco', 'Menlo', monospace;"
                        required
                    >
                </div>
                <button type="submit" class="btn" id="oauth-login-btn">
                    <i class="fas fa-sign-in-alt"></i> 登录
                </button>
            </form>

            <div id="login-loading" class="loading">
                <div class="spinner"></div>
                正在处理登录请求...
            </div>
        </div>

        <!-- User Panel -->
        <div id="user-panel" class="hidden">
            <!-- User Info -->
            <div class="card">
                <h3><i class="fas fa-user"></i> 用户信息</h3>
                <div id="user-info-container"></div>
            </div>

            <!-- Main Content Grid -->
            <div class="main-content">
                <!-- Chat Section -->
                <div class="card">
                    <h3><i class="fas fa-comments"></i> 智能对话</h3>
                    <div id="chat-container"></div>
                </div>

                <!-- Post Section -->
                <div class="card">
                    <h3><i class="fas fa-edit"></i> 发布帖子</h3>
                    <div id="post-container"></div>
                </div>
            </div>

            <!-- Feed 流显示 -->
            <div class="feed-container">
                <div class="card">
                    <h3><i class="fas fa-stream"></i> 动态流</h3>
                    <div id="feed-container"></div>
                </div>
            </div>

            <!-- MCP 管理 -->
            <div class="mcp-container">
                <div class="card">
                    <h3><i class="fas fa-plug"></i> MCP 服务器管理</h3>
                    <div id="mcp-container"></div>
                </div>
            </div>
        </div>

        <!-- Welcome Message -->
        <div id="welcome-message" class="card">
            <div class="welcome-animation">
                <div class="welcome-icon">
                    <i class="fas fa-rocket"></i>
                </div>
                <div class="welcome-text">
                    欢迎来到 AvatarAI Social！<br>
                    登录以开始你的智能社交之旅
                </div>
                <button id="welcome-login-btn" class="btn">
                    <i class="fas fa-sign-in-alt"></i> 立即登录
                </button>
            </div>
        </div>

        <!-- OAuth Callback Handler -->
        <div id="oauth-callback-handler" class="card hidden">
            <h3><i class="fas fa-cog fa-spin"></i> 正在完成登录...</h3>
            <div class="loading show">
                <div class="spinner"></div>
                正在处理授权码，请稍候...
            </div>
        </div>
    </div>

    <!-- Modals Container -->
    <div id="modals-container"></div>

    <!-- Scripts -->
    <script src="js/utils/constants.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/storage.js"></script>
    <script src="js/services/api.js"></script>
    <script src="js/services/websocket.js"></script>
    <script src="js/components/modals.js"></script>
    <script src="js/components/auth.js"></script>
    <script src="js/components/user-profile.js"></script>
    <script src="js/components/chat.js"></script>
    <script src="js/components/post.js"></script>
    <script src="js/components/feed.js"></script>
    <script src="js/components/mcp.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
